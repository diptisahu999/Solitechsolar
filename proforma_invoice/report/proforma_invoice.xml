<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <template id="report_proforma">
            <t t-call="web.basic_layout">
                <t t-foreach="docs" t-as="o">
                    <style>
                        .excel-table { width: 100%; border-collapse: collapse; font-family: Arial, sans-serif; }
                        .excel-table td, .excel-table th { border: 1px solid #000; padding: 4px 8px; font-size: 11px; }
                        .section-header { background-color: #D9D9D9; font-weight: bold; text-align: center; font-size: 12px; }
                        .label-cell { background-color: #F2F2F2; font-weight: bold; width: 15%; }
                        .value-cell { background-color: white; }
                        .text-center { text-align: center; }
                        .text-right { text-align: right; }
                        .note-content p { margin: 0; }
                    </style>

                    <div class="page">
                        <table style="width: 100%; border-collapse: collapse; font-family: Arial, sans-serif;">
                            <tr>
                                                                <!-- Column 1: Logo spanning 3 rows -->
                                <td style="width: 15%; text-align: left; vertical-align: middle; padding: 3px; height: 100%;" rowspan="3">
                                <img t-if="o.company_id.quotation_image" 
                                    t-att-src="image_data_uri(o.company_id.quotation_image)" 
                                    style="max-height: 86px;"/>

                                </td>
                                <td style="width: 12%; font-size: 10px; border: 1px solid black; padding: 4px; font-weight: bold;">Document No</td>
                                <td style="width: 13%; font-size: 10px; border: 1px solid black; padding: 4px;"><span t-esc="o.name"/></td>
                            </tr>
                            <tr>
                                <td style="font-size: 10px; border: 1px solid black; padding: 4px; font-weight: bold;">Issue Date</td>
                                <td style="font-size: 10px; border: 1px solid black; padding: 4px;"><span t-esc="o.invoice_date.strftime('%d-%m-%Y') if o.invoice_date else ''"/></td>
                            </tr>
                            <tr>
                                <td style="font-size: 10px; border: 1px solid black; padding: 4px; font-weight: bold;">Effective Date</td>
                                <td style="font-size: 10px; border: 1px solid black; padding: 4px;"><span t-esc="o.invoice_date.strftime('%d-%m-%Y') if o.invoice_date else ''"/></td>
                            </tr>
                        </table>

                        <table class="excel-table" style="width: 100%; border-collapse: collapse;">
                            <tr><td colspan="6" class="section-header">Company Details</td></tr>
                            <tr>
                                <td class="label-cell">Name</td>
                                <td class="value-cell"><t t-esc="o.company_id.name"/></td>
                                <td class="label-cell">GSTIN No</td>
                                <td class="value-cell"><t t-esc="o.company_id.vat or ''"/></td>
                                <td class="label-cell">Proforma #</td>
                                <td class="value-cell"><t t-esc="o.name"/></td>
                            </tr>
                            <tr>
                                <td class="label-cell" rowspan="3">Address</td>
                                <td class="value-cell" rowspan="3"><div t-field="o.company_id.partner_id" t-options='{"widget": "contact", "fields": ["address"], "no_marker": True}'/></td>
                                <td class="label-cell">Sales Person</td>
                                <td class="value-cell"><t t-esc="o.user_id.name if o.user_id else ''"/></td>
                                <td class="label-cell">Proforma Date</td>
                                <td class="value-cell"><t t-esc="o.invoice_date.strftime('%d-%m-%Y') if o.invoice_date else ''"/></td>
                            </tr>
                            <tr>
                                <td class="label-cell">Contact No</td>
                                <td class="value-cell"><t t-esc="o.company_id.phone or ''"/></td>
                                <td class="label-cell" rowspan="2">Customer Reference</td>
                                <td class="value-cell" rowspan="2"><t t-esc="o.po_number or ''"/></td>
                            </tr>
                            <tr>
                                <td class="label-cell">Email ID</td>
                                <td class="value-cell"><t t-esc="o.company_id.email or ''"/></td>
                            </tr>
                        </table>

                        <table class="excel-table" style="width:100%; border-collapse: collapse; margin-top: 0px;">
                            <colgroup><col style="width:12%;"/><col style="width:21%;"/><col style="width:12%;"/><col style="width:21%;"/><col style="width:12%;"/><col style="width:22%;"/></colgroup>
                            <tr><td colspan="6" class="section-header">Customer Details</td></tr>
                            <tr>
                                <td class="label-cell">Bill To</td>
                                <td colspan="2" class="value-cell"><t t-esc="o.partner_id.name"/></td>
                                <td class="label-cell">Ship To</td>
                                <td colspan="2" class="value-cell"><t t-esc="o.partner_shipping_id.name if o.partner_shipping_id else o.partner_id.name"/></td>
                            </tr>
                            <tr style="height:60px;">
                                <td colspan="3" class="value-cell" style="height:60px; vertical-align:top;"><div t-field="o.partner_id" t-options='{"widget": "contact", "fields": ["address"], "no_marker": True}'/></td>
                                <td colspan="3" class="value-cell" style="height:60px; vertical-align:top;"><div t-field="o.partner_shipping_id" t-options='{"widget": "contact", "fields": ["address"], "no_marker": True}'/></td>
                            </tr>
                            <tr>
                                <td class="label-cell">GSTIN No</td>
                                <td class="value-cell"><span t-field="o.partner_id.vat"/></td>
                                <td class="label-cell">Contact Person</td>
                                <td class="value-cell"><t t-esc="(o.partner_shipping_id or o.partner_id).name"/></td>
                                <td colspan="2" class="label-cell">Supply Timeline Requirement</td>
                            </tr>
                            <tr>
                                <td class="label-cell">PAN No</td>
                                <td class="value-cell"><span t-field="o.partner_id.l10n_in_pan"/></td>
                                <td class="label-cell">Contact No</td>
                                <td class="value-cell"><t t-esc="(o.partner_shipping_id or o.partner_id).phone"/></td>
                                <td class="label-cell">Delivery Start Date</td>
                                <td class="value-cell"><span t-field="o.sale_order_id.date_order" t-options='{"widget": "date", "format": "dd-MM-yyyy"}'/></td>
                            </tr>
                            <tr>
                                <td class="label-cell">CIN No</td>
                                <td class="value-cell"><span t-field="o.partner_id.company_registry"/></td>
                                <td class="label-cell">Email ID</td>
                                <td class="value-cell"><t t-esc="(o.partner_shipping_id or o.partner_id).email"/></td>
                                <td class="label-cell">Delivery End Date</td>
                                <td class="value-cell"><span t-field="o.sale_order_id.commitment_date" t-options='{"widget": "date", "format": "dd-MM-yyyy"}'/></td>
                            </tr>
                        </table>

                        <table class="excel-table" style="width:100%; border-collapse:collapse;">
                            <thead>
                                <tr><td colspan="13" class="section-header">Product &amp; Pricing Details</td></tr>
                                <tr class="label-cell">
                                    <td class="label-cell" style="width: 4%;">Sr #</td>
                                    <td class="label-cell" colspan="2" style="width: 12%;">Model No</td>
                                    <td class="label-cell" style="width: 7%;">HSN Code</td>
                                    <td class="label-cell" style="width: 7%;">Wattage (Wp)</td>
                                    <td class="label-cell" style="width: 10%;">Unit Price (₹ per Wp)</td>
                                    <td class="label-cell" style="width: 10%;">Unit Price (₹ per Nos)</td>
                                    <td class="label-cell" style="width: 6%;">Quantity (Nos)</td>
                                    <td class="label-cell" style="width: 6%;">Quantity (MW)</td>
                                    <td class="label-cell" style="width: 12%;">Total Line Amount (₹)</td>
                                    <td class="label-cell" style="width: 5%;">GST Rate (%)</td>
                                    <td class="label-cell" style="width: 7%;">GST Amount (₹)</td>
                                    <td class="label-cell" style="width: 14%;">Total Amount (₹)</td>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-set="line_no" t-value="1"/>
                                <t t-set="total_qty" t-value="0"/>
                                <t t-set="total_mw" t-value="0"/>
                                <t t-foreach="o.line_ids" t-as="line">
                                    <tr>
                                        <td class="value-cell text-center"><t t-esc="line_no"/></td>
                                        <td class="value-cell" colspan="2"><t t-esc="line.product_id.name"/></td>
                                        <td class="value-cell text-center"><span t-esc="line.product_id.l10n_in_hsn_code or ''"/></td>
                                        <td class="value-cell text-center"><t t-esc="line.sale_line_id.wattage"/></td>
                                        <td class="value-cell text-right" style="white-space: nowrap;">₹ <t t-esc="'%.2f' % line.price_unit"/></td>
                                        <td class="value-cell text-right" style="white-space: nowrap;">₹ <t t-esc="'%.2f' % line.sale_line_id.unit_price_per_nos"/></td>
                                        <td class="value-cell text-center"><t t-esc="'%.0f' % line.quantity"/></td>
                                        <td class="value-cell text-center"><t t-esc="'%.2f' % ((line.quantity * line.sale_line_id.wattage) / 1000000)"/></td>
                                        <td class="value-cell text-right" style="white-space: nowrap;">₹ <t t-esc="'{:,.2f}'.format(line.price_subtotal)"/></td>
                                        <td class="value-cell text-center">
                                            <t t-set="tax_rate" t-value="0"/>
                                            <t t-foreach="line.tax_ids" t-as="tax">
                                                <t t-if="tax.amount_type == 'group'"><t t-foreach="tax.children_tax_ids" t-as="child_tax"><t t-set="tax_rate" t-value="tax_rate + child_tax.amount"/></t></t>
                                                <t t-else=""><t t-set="tax_rate" t-value="tax_rate + tax.amount"/></t>
                                            </t>
                                            <t t-esc="'%.0f' % tax_rate"/>%
                                        </td>
                                        <td class="value-cell text-right" style="white-space: nowrap;">₹ <t t-esc="'{:,.2f}'.format(line.price_total - line.price_subtotal)"/></td>
                                        <td class="value-cell text-right" style="white-space: nowrap;">₹ <t t-esc="'{:,.2f}'.format(line.price_total)"/></td>
                                    </tr>
                                    <t t-set="line_no" t-value="line_no + 1"/>
                                    <t t-set="total_qty" t-value="total_qty + line.quantity"/>
                                    <t t-set="total_mw" t-value="total_mw + ((line.quantity * line.sale_line_id.wattage) / 1000000)"/>
                                </t>
                                <tr class="value-cell" style="font-weight:bold; background-color:#E7E6E6;">
                                    <td colspan="7" class="label-cell text-right">Total</td>
                                    <td class="value-cell text-center"><t t-esc="'%.0f' % total_qty"/></td>
                                    <td class="value-cell text-center"><t t-esc="'%.2f' % total_mw"/></td>
                                    <td class="value-cell text-right" style="white-space: nowrap;">₹ <t t-esc="'{:,.2f}'.format(o.amount_untaxed)"/></td>
                                    <td class="value-cell"></td>
                                    <td class="value-cell text-right" style="white-space: nowrap;">₹ <t t-esc="'{:,.2f}'.format(o.amount_tax)"/></td>
                                    <td class="value-cell text-right" style="white-space: nowrap;">₹ <t t-esc="'{:,.2f}'.format(o.amount_total)"/></td>
                                </tr>
                                <tr>
                                    <td colspan="12" class="label-cell text-right" style="border:1px solid #000;">Total Value</td>
                                    <td class="value-cell text-right" style="white-space: nowrap; border:1px solid #000;">₹ <t t-esc="'{:,.2f}'.format(o.amount_untaxed)"/></td>
                                </tr>
                                <tr>
                                    <td colspan="12" class="label-cell text-right" style="border:1px solid #000;">SGST</td>
                                    <td class="value-cell text-right" style="white-space: nowrap; border:1px solid #000;">₹ <t t-esc="'{:,.2f}'.format(o.amount_tax / 2)"/></td>
                                </tr>
                                <tr>
                                    <td colspan="12" class="label-cell text-right" style="border:1px solid #000;">CGST</td>
                                    <td class="value-cell text-right" style="white-space: nowrap; border:1px solid #000;">₹ <t t-esc="'{:,.2f}'.format(o.amount_tax / 2)"/></td>
                                </tr>
                                <tr style="font-weight:bold;">
                                    <td colspan="12" class="label-cell text-right" style="border:1px solid #000;">Total</td>
                                    <td class="value-cell text-right" style="white-space: nowrap; border:1px solid #000;">₹ <t t-esc="'{:,.2f}'.format(o.amount_total)"/></td>
                                </tr>
                            </tbody>
                        </table>

                        <table class="excel-table" style="width:100%; border-collapse:collapse;">
                            <tr>
                                <td class="label-cell">Amount in Words :</td>
                                <td colspan="11" class="value-cell"><t t-esc="o.amount_to_text(o.amount_total)"/> Only</td>
                            </tr>
                        </table>
                        
                        <table class="excel-table" style="width:100%; border-collapse: collapse; border: 1px solid #000;">
                            <thead>
                                <tr>
                                    <td colspan="3" class="section-header" style="text-align:center; padding:4px;">Bank Details</td>
                                    <td colspan="1" class="section-header" style="text-align:center; padding:4px;">Special Instructions</td>
                                </tr>
                                <tr>
                                    <td class="label-cell" style="width:5%; text-align:center; border-right:1px solid #000; padding:4px;">Sr #</td>
                                    <td class="label-cell" style="width:10%; border-right:1px solid #000; padding:4px;">Particulars</td>
                                    <td class="label-cell" style="width:30%; border-right:1px solid #000; padding:4px;">Details</td>
                                    <td class="value-cell" style="width:40%; border-left:1px solid #000; padding:4px; font-weight:bold;"><span t-esc="o.line_ids[0].name if o.line_ids else ''"/></td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr style="border-top:1px solid #000;">
                                    <td class="value-cell" style="text-align:center; border-right:1px solid #000; padding:4px;">1</td>
                                    <td class="value-cell" style="border-right:1px solid #000; padding:4px;">Bank Name</td>
                                    <td class="value-cell" style="border-right:1px solid #000; padding:4px;"><span t-esc="o.company_id.bank_name"/></td>
                                    <td class="value-cell" style="padding:4px;"><span t-esc="dict(o.sale_order_id._fields['special_instruction_dcr'].selection).get(o.sale_order_id.special_instruction_dcr, '') if o.sale_order_id.special_instruction_dcr else ''"/></td>
                                </tr>
                                <tr style="border-top:1px solid #000;">
                                    <td class="value-cell" style="text-align:center; border-right:1px solid #000; padding:4px;">2</td>
                                    <td class="value-cell" style="border-right:1px solid #000; padding:4px;">Account Name</td>
                                    <td class="value-cell" style="border-right:1px solid #000; padding:4px;"><span t-esc="o.company_id.bank_ac_name"/></td>
                                    <td class="value-cell" style="padding:4px;"><span t-esc="dict(o.sale_order_id._fields['special_instruction_mess'].selection).get(o.sale_order_id.special_instruction_mess, '') if o.sale_order_id.special_instruction_mess else ''"/></td>
                                </tr>
                                <tr style="border-top:1px solid #000;">
                                    <td class="value-cell" style="text-align:center; border-right:1px solid #000; padding:4px;">3</td>
                                    <td class="value-cell" style="border-right:1px solid #000; padding:4px;">Account Number</td>
                                    <td class="value-cell" style="border-right:1px solid #000; padding:4px;"><span t-esc="o.company_id.bank_ac_no"/></td>
                                    <td class="value-cell" style="padding:4px;">Note</td>
                                </tr>
                                <tr style="border-top:1px solid #000;">
                                    <td class="value-cell" style="text-align:center; border-right:1px solid #000; padding:4px;">4</td>
                                    <td class="value-cell" style="border-right:1px solid #000; padding:4px;">IFSC Code</td>
                                    <td class="value-cell" style="border-right:1px solid #000; padding:4px;"><span t-esc="o.company_id.bank_branch_ifsc"/></td>
                                    <td class="value-cell note-content" style="vertical-align: top; padding:4px;"><span t-field="o.narration" t-options="{'widget':'html'}"/></td>
                                </tr>
                            </tbody>
                        </table>
                        
                        <table class="excel-table" style="width:100%; border-collapse: collapse; border: 1px solid #000;">
                           <thead><tr><td colspan="6" class="section-header"> Commercial Terms </td></tr></thead>
                            <tbody>
                                <tr>
                                    <td class="label-cell"><strong>Payment Terms</strong></td>
                                    <td colspan="2" class="value-cell"><span t-esc="o.invoice_payment_term_id.name if o.invoice_payment_term_id else ''"/></td>
                                    <td class="label-cell"><strong>Packing Type</strong></td>
                                    <td colspan="2" class="value-cell"><span>Standard Export Packing</span></td>
                                </tr>
                                <tr>
                                    <td class="label-cell"><strong>Delivery Terms</strong></td>
                                    <td colspan="2" class="value-cell"><span t-esc="o.sale_order_id.incoterm.name if o.sale_order_id.incoterm else 'Ex-Works'"/></td>
                                    <td class="label-cell"><strong>Delivery Location</strong></td>
                                    <td colspan="2" class="value-cell"><t t-if="o.partner_shipping_id"><span t-esc="o.partner_shipping_id.city"/>, <span t-esc="o.partner_shipping_id.state_id.name"/></t></td>
                                </tr>
                                <tr>
                                    <td class="label-cell"><strong>Offer Validity</strong></td>
                                    <td colspan="2" class="value-cell">
                                        <t t-if="o.sale_order_id.validity_date"><span>Valid until <t t-esc="o.sale_order_id.validity_date.strftime('%d-%m-%Y')"/></span></t>
                                        <t t-else=""><span>15 days from proforma date</span></t>
                                    </td>
                                    <td class="label-cell"><strong>Delivery Schedule</strong></td>
                                    <td colspan="2" class="value-cell"><span>As per mutual agreement</span></td>
                                </tr>
                            </tbody>
                        </table>
                        
                        </div>
                </t>
            </t>
        </template>
    </data>
</odoo>